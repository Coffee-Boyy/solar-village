[Interface]
Address = {{ wg_ip }}/24
ListenPort = {{ wg_port }}
PrivateKey = {{ lookup('file', '/etc/wireguard/private.key') }}
# Optional MTU tune if needed behind VPS NATs (uncomment if seeing fragmentation)
# MTU = 1380

{% for peer in groups['wg_all'] if peer != inventory_hostname %}
[Peer]
PublicKey = {{ hostvars[peer].wg_public_key }}
AllowedIPs = {{ hostvars[peer].wg_ip }}/32
Endpoint = {{ hostvars[peer].ansible_host }}:{{ hostvars[peer].wg_port }}
PersistentKeepalive = {{ wg_keepalive }}
{% endfor %}
